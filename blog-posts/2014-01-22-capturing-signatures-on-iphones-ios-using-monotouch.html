<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Capturing Signatures on iphones (iOS) using MonoTouch</title>
  <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
  <!-- Font Awesome icons -->
  <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
  <!-- Google fonts -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="../assets/css/freelancer-style.css">
</head>
<body id="page-top" class="d-flex flex-column min-vh-100">
  <!-- Navigation -->
  <nav id="mainNav" class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top">
    <div class="container">
      <a class="navbar-brand" href="../index.html">Has Altaiar</a>
      <button class="navbar-toggler text-uppercase font-weight-bold bg-primary text-white rounded" type="button"
        data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="#navbarResponsive"
        aria-expanded="false" aria-label="Toggle navigation">
        Menu <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item mx-0 mx-lg-1">
            <a class="nav-link py-3 px-0 px-lg-3 rounded" href="../index.html">Home</a>
          </li>
          <li class="nav-item mx-0 mx-lg-1">
            <a class="nav-link py-3 px-0 px-lg-3 rounded" href="../blog.html">Blog</a>
          </li>
          <li class="nav-item mx-0 mx-lg-1">
            <a class="nav-link py-3 px-0 px-lg-3 rounded" href="../books.html">Books</a>
          </li>
          <li class="nav-item mx-0 mx-lg-1">
            <a class="nav-link py-3 px-0 px-lg-3 rounded" href="../speaking.html">Speaking</a>
          </li>
          <li class="nav-item mx-0 mx-lg-1">
            <a class="nav-link py-3 px-0 px-lg-3 rounded" href="../about.html">About</a>
          </li>
          <li class="nav-item mx-0 mx-lg-1">
            <a class="nav-link py-3 px-0 px-lg-3 rounded" href="../contact.html">Contact</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <main class="flex-shrink-0" style="margin-top: 7rem !important;">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-8">
          <h2 class="text-center text-uppercase text-secondary mb-4">Capturing Signatures on iphones (iOS) using MonoTouch</h2>
          <p class="text-center text-muted"><em>January 22, 2014</em></p>
          <div class="blog-post-content card shadow p-4 mb-5 bg-white rounded">
            <p>In the <a href="http://www.hasaltaiar.com.au/capturing-signatures-on-android-devices-monoforandroid/" target="_blank">previous post</a>, I demonstrated how to capture a signature on Android devices.</p>
<p>In this post, we will look at how to do the same thing on iOS devices (iPhones, iPads, etc).</p>
<p>Basically, the idea is very simple, we create a custom view and we listen to touches on that view. This includes TouchBegins(), TouchMoved(), and TouchEnds().</p>
<p>Then with each touch we update our list of points. In <a href="http://www.hasaltaiar.com.au/capturing-a-signature-as-a-string-of-points-on-the-mobile-and-redrawing-it-on-the-server/" target="_blank">another previous post</a> I showed how to stringify a two dim array of points to a string. Then use this to reconstruct the signature on the server side.</p>
<p>However, we could also capture the signature as an image on the mobile device and take that to the server if you wish to get an image directly instead of the list of points.</p>
<p>The code below shows the SignatureView.</p>
<pre class="brush: csharp; title: ; notranslate" title="">using MonoTouch.CoreGraphics;
using MonoTouch.UIKit;
using System.Drawing;
using System;
using MyApp.Interfaces;
using MonoTouch.Foundation;
using MyApp.Core.Signature;
using MyApp.Core.Drawing;
using MyApp.Interfaces.Drawing;
using MyApp.Interfaces.Screens.Controls;
using System.Linq;
using System.Collections.Concurrent;

namespace MyApp.Controls
{
    public class SignatureView : UIControl, ISignatureView
    {
        public SignatureView (RectangleF frame) : base(frame)
        {
            base.Frame = frame;
            ViewFrame = new MyFrame {
                X = (int)frame.X,
                Y = (int)frame.Y,
                Width = frame.Width,
                Height = frame.Height
            };
            _DrawPath = new CGPath();
            SetupAppearance();
            _ScalingFactor = new MyFrame { Width = 1, Height = 1 };
            DrawWatermarks();
        }

        public void Initialise(int penWidth, WatermarkSettings watermarks, string backgroundImageFileName)
        {
            PenWidth = penWidth;
            Watermarks = watermarks;
            BackgroundImageFileName = backgroundImageFileName;

            var dimensions = new MyFrame
            {
                Width = Frame.Width,
                Height = Frame.Height
            };

            _SignatureData = new SignatureData(dimensions, _ScalingFactor, watermarks);
        }

        public void Clear ()
        {
            _DrawPath.Dispose();
            _DrawPath = new CGPath();
            _FingerDraw = false;
            _TouchLocation = new PointF(0, 0);
            _PrevTouchLocation = new PointF(0, 0);
            SetNeedsDisplay();
            _SignatureData.Clear();
            DrawWatermarks();
            _TouchsQueue = new ConcurrentQueue&lt;TouchsQueue&gt;();
        }

        public override void TouchesBegan(NSSet touches, UIEvent evt)
        {
            base.TouchesBegan (touches, evt);

            UITouch touch = touches.AnyObject as UITouch;
            this._FingerDraw = true;
            this._TouchLocation = touch.LocationInView (this);
            this._PrevTouchLocation = touch.PreviousLocationInView (this);
            _SignatureData.AddPoint(SignatureState.Start, (int)this._TouchLocation.X, (int)this._TouchLocation.Y);
        }

        public override void TouchesEnded(NSSet touches, UIEvent e)
        {
            base.TouchesEnded(touches, e);
            if (this._FingerDraw)
            {
                UITouch touch = touches.AnyObject as UITouch;
                _TouchLocation = touch.LocationInView(this);
                _PrevTouchLocation = touch.PreviousLocationInView(this);
                _FingerDraw = false;
                _TouchsQueue.Enqueue(new TouchsQueue {TouchLocation = _TouchLocation, PrevTouchLocation = _PrevTouchLocation });
                _SignatureData.AddPoint(SignatureState.End, (int)this._TouchLocation.X, (int)this._TouchLocation.Y);
                this.SetNeedsDisplay ();
            }
        }

        public override void TouchesMoved (NSSet touches, UIEvent evt)
        {
            base.TouchesMoved (touches, evt);

            UITouch touch = touches.AnyObject as UITouch;
            _TouchLocation = touch.LocationInView(this);
            _PrevTouchLocation = touch.PreviousLocationInView(this);
            _TouchsQueue.Enqueue(new TouchsQueue {TouchLocation = _TouchLocation, PrevTouchLocation = _PrevTouchLocation });
            _SignatureData.AddPoint(SignatureState.Move, (int)this._TouchLocation.X, (int)this._TouchLocation.Y);
            SetNeedsDisplay();
        }

        public override void Draw (RectangleF rect)
        {
            base.Draw (rect);
            if (_DrawPath != null)
            {
                using (CGContext context = UIGraphics.GetCurrentContext())
                {
                    if (context != null)
                    {
                        DrawBackgroundImage(context);
                        DrawSignatureLines(context);
                    }
                }
            }
        }

        private void DrawSignatureLines(CGContext context)
        {
            TouchsQueue queueElement = null;
            while(_TouchsQueue.TryDequeue(out queueElement))
            {
                if (queueElement != null)
                {
                    context.SetStrokeColor(UIColor.Black.CGColor);
                    context.SetLineWidth(PenWidth);
                    context.SetLineJoin(CGLineJoin.Round);
                    context.SetLineCap(CGLineCap.Round);
                    _DrawPath.MoveToPoint(queueElement.PrevTouchLocation);
                    _DrawPath.AddLineToPoint(queueElement.TouchLocation);
                    context.AddPath(_DrawPath);
                    context.DrawPath(CGPathDrawingMode.Stroke);
                }
            }
        }

        public string GetSignatureData()
        {
            var result = string.Empty;
            if (_SignatureData != null)
            {
                try
                {
                    result = _SignatureData.ExtractAsString();
                }
                catch (Exception exception)
                {
                    OnFailedWithException(exception);
                }
            }
            return result;
        }

        #region Implementation

        private PointF _TouchLocation;
        private PointF _PrevTouchLocation;
        private CGPath _DrawPath;
        private bool _FingerDraw;
        private ConcurrentQueue&lt;TouchsQueue&gt; _TouchsQueue = new ConcurrentQueue&lt;TouchsQueue&gt;();
        private IMyFrame _ScalingFactor;
        private SignatureData _SignatureData { get; set; }
        private UIImage _BackgroundImage;

        public SignatureData SignatureData { get { return _SignatureData; } }
        public event SignatureFailedWithExceptionHandler SignatureFailedWithException;
        public string BackgroundImageFileName { get; set; }
        public int PenWidth { get; set; }
        public IMyFrame BackgroundImageFrame { get; set; }
        public WatermarkSettings Watermarks {get;set;}
        public IMyFrame ViewFrame { get; set; }

        private void OnFailedWithException(Exception exception)
        {
            if (SignatureFailedWithException != null)
            {
                SignatureFailedWithException(exception);
            }
        }

        private void SetupAppearance ()
        {
            BackgroundColor = UIColor.White;
            Layer.BorderWidth = 5f;
            Layer.BorderColor = UIColor.Orange;
        }

        #endregion
    }

    public class TouchsQueue
    {
        public PointF TouchLocation {get;set;}
        public PointF PrevTouchLocation { get; set; }
    }
}
</pre>

<p>The main thing to notice is that after the end of each touch event, we invalidate the view to cause the app to call Draw() method. Then in the Draw() method we use our two dimensional list of points and draw the signature.</p>
<p>You could notice that I am drawing Watermarks as well, but that is another topic by itself that I would try to blog about another time.</p>
<p>The other thing is that we have a TouchQueue. This is used because iOS sometimes defensively skip some requests to invalidate (redraw) the view if there are multiple touches in a short time-frame. This will cause the signature line to be segmented with gaps in between.</p>
<p>If you prefer to get an image directly instead of collecting the images and passing them to the server, you could do so easily using the Graphics context of the view as below:</p>
<pre class="brush: csharp; title: ; notranslate" title="">public UIImage GetDrawingImage ()
{
    UIImage returnImg = null;
    UIGraphics.BeginImageContext (this.Bounds.Size);

    using (CGContext context = UIGraphics.GetCurrentContext()) {
        context.SetStrokeColor (UIColor.Black.CGColor);
        context.SetLineWidth (5f);
        context.SetLineJoin (CGLineJoin.Round);
        context.SetLineCap (CGLineCap.Round);
        context.AddPath (this._DrawPath);
        context.DrawPath (CGPathDrawingMode.Stroke);
        returnImg = UIGraphics.GetImageFromCurrentImageContext ();
    }

    UIGraphics.EndImageContext ();
    return returnImg;
}
</pre>

<p>Again, I hope you find this useful, and please do let me know if you have any questions or comments.</p>
  </main>
  <footer class="footer text-center mt-auto">
    <div class="container">
      <div class="row">
        <!-- Footer Location -->
        <div class="col-lg-4 mb-5 mb-lg-0">
          <h4 class="text-uppercase mb-4">Location</h4>
          <p class="lead mb-0">
            Sharing from Melbourne, Australia<br>
            Trying to make a dent in the universeâ€”one typo at a time.
          </p>
        </div>
        <!-- Footer Social Icons -->
        <div class="col-lg-4 mb-5 mb-lg-0">
          <h4 class="text-uppercase mb-4">Around the Web</h4>
          <a class="btn btn-outline-light btn-social mx-1" href="https://www.linkedin.com/in/altaiar/">
            <i class="fab fa-fw fa-linkedin-in"></i>
          </a>
          <a class="btn btn-outline-light btn-social mx-1" href="https://twitter.com/hasaltaiar">
            <i class="fab fa-fw fa-twitter"></i>
          </a>
          <a class="btn btn-outline-light btn-social mx-1" href="https://github.com/has-taiar">
            <i class="fab fa-fw fa-github"></i>
          </a>
        </div>
        <!-- Footer About Text -->
        <div class="col-lg-4">
          <h4 class="text-uppercase mb-4">Hello</h4>
          <p class="lead mb-0">
            Here you find random thoughts and insights on cloud technologies, AI, and life with some rare wisdom from a technologist's perspective.
          </p>
        </div>
      </div>
    </div>
  </footer>
  <div class="copyright py-4 text-center text-white">
    <div class="container">
      <small>Copyright &copy; Has Altaiar 2025</small>
    </div>
  </div>
  <!-- Bootstrap core JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Custom JS -->
  <script src="../assets/js/freelancer-scripts.js"></script>
</body>
</html>